<!DOCTYPE html>
<html lang="en">
<head>
	<title>Cutera TCO</title>
	<link href="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" type="text/css" href="flippant/flippant.css">
	<link rel="stylesheet" type="text/css" href="jqplot/jquery.jqplot.css">
</head>

<body>
	<div class="container">
		<div class="hero-unit">
			<h1>Cutera</h1>
			<p>We're the cheapest! Don't believe us, just do the math.</p>
		</div>
		<div class="row">
			<div class="span4">
				<div class="well">
					<div class="row-fluid">
						<div class="span8">
							<h2>Cutera</h2>
						</div>
						<div class="span4">
							<button class="btn btn-link" id="cuteraAssumptions">Assumptions</button>
						</div>
					</div>
					<div class="row-fluid">
						<div class="span6">
							Machine Cost
						</div>
						<div class="span6">
							<div class="input-prepend">
								<span class="add-on span3">$</span>
								<input type="text" class="span9" placeholder="" value="120000"  id="cuteraMachineCost">
							</div>
						</div>
					</div>
					<div class="row-fluid">
						<div class="span6">
							Consumable Cost
						</div>
						<div class="span6">
							<div class="input-prepend">
								<span class="add-on span3">$</span>
								<input type="text" class="span9" placeholder="" value="0"  id="cuteraConsumableCost">
							</div>
						</div>
					</div>
				</div>
				<div class="well back cutetaBack">
					<div class="row-fluid">
						<div class="span8">
							<h4>Cutera Consumable Cost Breakdown</h4>
						</div>
					</div>
				</div>
			</div>
			<div class="span4">
				<div class="well">
					<div class="row-fluid">
						<div class="span8">
							<h2>Candela</h2>
						</div>
						<div class="span4">
							<button class="btn btn-link" id="cuteraAssumptions">Assumptions</button>
						</div>
					</div>
					<div class="row-fluid">
						<div class="span6">
							Machine Cost
						</div>
						<div class="span6">
							<div class="input-prepend">
								<span class="add-on span3">$</span>
								<input type="text" class="span9" placeholder="" value="92500" id="compMachineCost">
							</div>
						</div>
					</div> 
					<div class="row-fluid">
						<div class="span6">
							Consumable Cost
						</div>
						<div class="span6">
							<div class="input-prepend">
								<span class="add-on span3">$</span>
								<input type="text" class="span9" placeholder="" value="0"  id="compConsumableCost">
							</div>
						</div>
					</div>
				</div>
				<div class="well back compBack">
					<div class="row-fluid">
						<div class="span8">
							<h4>Candela Consumable Cost Breakdown</h4>
						</div>
					</div>
				</div>
			</div>
			<div class="span4">
				<!--<div class="well"> -->
					<div class="row-fluid">
						<div class="span8">
							<h2>Time</h2>
						</div>
					</div>
					<div class="row-fluid">
						<div class="span6">
							Treatments per month
						</div>
						<div class="span6">
								<input type="text" class="span12" placeholder="" value="30" id="totalTreatments">
						</div>
					</div> 
					<div class="row-fluid">
						<div class="span6">
							Duration of Lease
						</div>
						<div class="span6">
							<select class="span12"  id="timeFrame">
								<option>3 years</option>
								<option>4 years</option>
								<option>5 years</option>
							</select>
						</div>
					</div> 
					<div class="row-fluid">
						<div class="span6">
							Interest Rate
						</div>
						<div class="span6">
								<input type="text" class="span12" placeholder="" value="6.00" id="interestRate">
						</div>
					</div> 
				<!-- </div> -->
			</div>
		</div>
		<div class="row">
			<div class="span12">
				<div class="well">
					<div class="row-fluid">
						<div class="span12">
							<div id="chartdiv" class="span12" style="height:400px;">
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<script src="http://code.jquery.com/jquery.js"></script>
	<script type="text/javascript" src="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/js/bootstrap.min.js"></script>
	<script type="text/javascript" src="flippant/flippant.js"></script>
	<script type="text/javascript" src="jqplot/jquery.jqplot.js"></script>
	<script>
		var thePlot;
		
		var competitorAssumptions = {
			perShot: {
				cryogen: 0.02,
				window: 0.02,
			},
			perYear: {
				service: 7000,
				fiber: 1200,
				distanceGuage: (35*2)*52,
			},
		};
		
		var cuteraAssumptions = {
			perShot: {
				none: 0.00,
			},
			perYear: {
				service: 12900,
			},		
		};
		
		var shotsPerTreatment = 30;
		
		function updateGraph() {
			var timeSpan = $("#timeFrame").val();
			timeSpan = parseFloat(timeSpan.replace(/\D/g,''));
			timeSpan = timeSpan * 12;
			
			var interestRate = $("#interestRate").val();
			interestRate = parseFloat(interestRate);
			
			var totalTreatments = parseFloat($("#totalTreatments").val());
			totalTreatments = totalTreatments * 12;
			var shotsPerTime = (totalTreatments*shotsPerTreatment)/12*timeSpan;
			
			var cuteraCost = parseFloat($("#cuteraMachineCost").val());
			
			var cuteraPerTreatmentCost = 0;
			for(var property in cuteraAssumptions.perShot) {
				cuteraPerTreatmentCost = cuteraPerTreatmentCost + cuteraAssumptions.perShot[property];
			}
			var cuteraPerYearCost = 0;
			for(var property in cuteraAssumptions.perYear) {
				cuteraPerYearCost = cuteraPerYearCost + cuteraAssumptions.perYear[property];
			}
			var cuteraPerMonthCost = cuteraCost * ( (interestRate/100/12)/(1-Math.pow(1+interestRate/100/12,-1*timeSpan)));
			for(var property in cuteraAssumptions.perMonth) {
				cuteraPerMonthCost = cuteraPerMonthCost + cuteraAssumptions.perMonth[property];
			}
			
			var cuteraTotalCost = new Array();
			cuteraTotalCost[0] = 0;
			for(var month=1; month<timeSpan; month++) {
				var costSoFar = cuteraTotalCost[month-1] + shotsPerTime*1*cuteraPerTreatmentCost + cuteraPerMonthCost;
				
				if (month > 0 && month % 12 == 0) {
					costSoFar = costSoFar + cuteraPerYearCost;
				}
				
				cuteraTotalCost.push(costSoFar);
			}
			
			var compCost = parseFloat($("#compMachineCost").val());
			var compPerTreatmentCost = 0;
			for(var property in competitorAssumptions.perShot) {
				compPerTreatmentCost = compPerTreatmentCost + competitorAssumptions.perShot[property];
			}
			var compPerYearCost = 0;
			for(var property in competitorAssumptions.perYear) {
				compPerYearCost = compPerYearCost + competitorAssumptions.perYear[property];
			}
			var compPerMonthCost = compCost * ( (interestRate/100/12)/(1-Math.pow(1+interestRate/100/12,-1*timeSpan)));
			for(var property in competitorAssumptions.perMonth) {
				compPerMonthCost = compPerMonthCost + competitorAssumptions.perMonth[property];
			}
			
			var compTotalCost = new Array();
			compTotalCost[0] = 0;
			
			for(var month=1; month<timeSpan; month++) {
				var costSoFar =  compTotalCost[month-1] +  shotsPerTime*1*compPerTreatmentCost + compPerMonthCost;

				if (month > 0 && month % 12 == 0) {
					costSoFar = costSoFar + compPerYearCost;
				}
				compTotalCost.push(costSoFar);
			}
			
			var compConsumablePerMonthCost = 0;
			for(var property in competitorAssumptions.perMonth) {
				compConsumablePerMonthCost = compConsumablePerMonthCost + competitorAssumptions.perMonth[property];
			}
			var totalConsumableCost = compConsumablePerMonthCost*timeSpan + shotsPerTime*timeSpan*compPerTreatmentCost + compPerYearCost*((timeSpan/12)-1);
			$('#compConsumableCost').val(totalConsumableCost.toFixed(0));
			
			$("#chartdiv").empty();
			thePlot = null;
			thePlot = $("#chartdiv").jqplot ([cuteraTotalCost,compTotalCost],{
				// Set default options on all series, turn on smoothing.
				seriesDefaults: {
					rendererOptions: {
					smooth: false
					}
				},
				// Series options are specified as an array of objects, one object
				// for each series.
				series:[ 
					{	//cutera
						label:'Cutera',
						lineWidth:4, 
						markerOptions: { show:false },
						color: '#afbe85',
						shadow: false,
					}, 
					{	//competitor
						label: 'Candela',
						lineWidth:2, 
						markerOptions: { show:false },
						color: '#c333a5',
						shadow: false,
					}
				],
				grid: {
					background: '#ffffff',
				},
				axes: {
					xaxis: {
						min: 1,
						max: timeSpan,
						numberTicks: timeSpan/1,
						label: "month",
						labelRenderer: $.jqplot.CanvasAxisLabelRenderer,
						labelOptions: {
							fontFamily: 'Georgia, Serif',
							fontSize: '12pt'
						},
					},
					yaxis: {
						min: 0,
						label: "cost",
						labelOptions: {
							fontFamily: 'Georgia, Serif',
							fontSize: '12pt'
						},
						tickOptions: {
							 formatString: "$%'.1f"
						},
					},
				},
				legend: {
					show: true,
					location: 'nw',
				},
			});
		}
	
		$("input").change(function(){
			updateGraph()
		});
		
		$("select").change(function(){
			updateGraph()
		});
	
		$(document).resize(function(){
			updateGraph();
		});
	
		function printAssumptions(theAssumptions, theClass) {
			for(var type in theAssumptions) {
				if (theAssumptions.hasOwnProperty(type)) {
					var element = document.createElement('div');
					$(element).addClass('row-fluid');
					
					var propertyText = type.split(/(?=[A-Z])/)
					propertyText = propertyText.join(' ');
					propertyText = propertyText.toLowerCase();
					propertyText = propertyText.slice(0,1).toUpperCase() + propertyText.slice(1);
					
					var span = document.createElement('div');
					$(span)
						.addClass('span6')
						.text(propertyText);
					$(element).append(span);
					
					var lastAssumption = $(theClass).children();
					lastAssumption = lastAssumption[lastAssumption.length-1];
					$(lastAssumption).append(element);
				}
				
				for(var property in theAssumptions[type]) {
					if (theAssumptions[type].hasOwnProperty(property)) {
						var element = document.createElement('div');
						$(element).addClass('row-fluid');
						
						var propertyText = property.split(/(?=[A-Z])/)
						propertyText = propertyText.join(' ');
						propertyText = propertyText.toLowerCase();
						propertyText = propertyText.slice(0,1).toUpperCase() + propertyText.slice(1);
						
						var span = document.createElement('div');
						$(span).addClass('span1')
						$(element).append(span);
						
						var span = document.createElement('div');
						$(span)
							.addClass('span6')
							.text(propertyText);
						$(element).append(span);
						
						span = document.createElement('div');
						$(span)
							.addClass('span5')
							.text('$'+theAssumptions[type][property]);
						
						$(element).append(span);
						
						var lastAssumption = $(theClass).children();
						lastAssumption = lastAssumption[lastAssumption.length-1];
						$(lastAssumption).append(element);
					}
				}
			}			
		}
	
		$( document ).ready(function() {
			printAssumptions(cuteraAssumptions, '.cutetaBack');
			printAssumptions(competitorAssumptions, '.compBack');
			
			$( ".back").hide();
			updateGraph();

		});
		
		$(".btn").click(function(){
				var frontOfCard = $( this ).parents(".well");
				frontOfCard = frontOfCard[0];	//chane to not assume will return at least 1
				var backOfCard = $(frontOfCard).siblings(".back");
				backOfCard = backOfCard[0];
				var flip = flippant.flip(frontOfCard,$(backOfCard).html());
				$(frontOfCard).css( "zIndex", -1000 );
				$("body").append($("<div>").css({
					position: "fixed"
					,width: "100%"
					,height: "100%"
					,"background-color": "#000"
					,opacity: 0.8
					,"z-index": 500
					,top: 0
					,left: 0
				}).attr("id","page-cover").hide().fadeIn(750));
				
				setTimeout(function(){
					$(document).bind('click.cutera', function(e){
						console.log('heyo');
						if (flip != null) {
							flip = flip.close();
						}
						flip = null;
						$(document).unbind('click.cutera');
						$("#page-cover").fadeOut(500, function(){$(this).remove();});
					});
					
					$(document).bind('touchstart click', function(e){
						console.log('heyo');
						if (flip != null) {
							flip = flip.close();
						}
						flip = null;
						$(document).unbind('touchstart click');
						$("#page-cover").fadeOut(500, function(){$(this).remove();});
					});
				},100);

		});
	</script>
</body>
</html>